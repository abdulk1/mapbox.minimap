/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t=function(i,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])})(i,o)};var i=window.mapboxgl?window.mapboxgl:void 0,o=function(o){function e(t){var i=o.call(this)||this;return i.config=t,i.lastMouseMoveEvent=null,i.ticking=!1,i.lastMouseMoveEvent=null,i.parentMap=null,i.miniMap=null,i.isDragging=!1,i.isCursorOverFeature=!1,i.previousPoint=[0,0],i.currentPoint=[0,0],i.trackingRectCoordinates=[[[],[],[],[],[]]],i.minimized=!1,i.options={id:"mapboxgl-minimap",width:320,height:180,style:"mapbox://styles/mapbox/streets-v8",center:[0,0],zoom:6,zoomAdjust:null,zoomLevels:[[18,14,16],[16,12,14],[14,10,12],[12,8,10],[10,6,8]],lineColor:"#08F",lineWidth:1,lineOpacity:1,fillColor:"#F80",fillOpacity:.25,dragPan:!1,scrollZoom:!1,boxZoom:!1,dragRotate:!1,keyboard:!1,doubleClickZoom:!1,touchZoomRotate:!1,minimized:!1,toggleDisplay:!0,collapsedWidth:20,collapsedHeight:20,togglePosition:"bottomleft",showText:"Show Minimap",hideText:"Hide Minimap"},t&&Object.assign(i.options,t),i}return function(i,o){function e(){this.constructor=i}t(i,o),i.prototype=null===o?Object.create(o):(e.prototype=o.prototype,new e)}(e,o),e.prototype.onAdd=function(t){this.parentMap=t;var o=this.options,e=this.createContainer(t);this.container=e;var n=this.miniMap=new i.Map({attributionControl:!1,container:e,style:o.style,zoom:o.zoom,center:o.center});return o.maxBounds&&n.setMaxBounds(o.maxBounds),this.onLoad=this.load.bind(this),n.on("load",this.onLoad),this.options.toggleDisplay&&this.addToggleButton(),this.container},e.prototype.onRemove=function(){this.parentMap.off("move",this.onMove),this.miniMap.off("load",this.onLoad),this.miniMap.off("mousemove",this.onMouseMove),this.miniMap.off("mousedown",this.onMouseDown),this.miniMap.off("mouseup",this.onMouseUp),this.miniMap.off("touchmove",this.onMouseMove),this.miniMap.off("touchstart",this.onMouseDown),this.miniMap.off("touchend",this.onMouseUp),this.miniMapCanvas.removeEventListener("wheel",this.preventDefault),this.miniMapCanvas.removeEventListener("mousewheel",this.preventDefault),this.toggleDisplayButton.removeEventListener("click",this.preventDefault),this.toggleDisplayButton.removeEventListener("mousedown",this.preventDefault),this.toggleDisplayButton.removeEventListener("dblclick",this.preventDefault),this.toggleDisplayButton.removeEventListener("click",this.onToggleButtonClick),this.container.removeEventListener("contextmenu",this.preventDefault),this.container.removeChild(this.toggleDisplayButton),this.container.parentNode.removeChild(this.container),this.miniMap=null},e.prototype.addToggleButton=function(){this.toggleDisplayButton=this.options.toggleDisplay?this.createButton("",this.toggleButtonInitialTitleText(),"mapbox-ctrl-minimap-toggle-display mapbox-ctrl-minimap-toggle-display-"+this.options.togglePosition,this.container,this.toggle,this):void 0,this.toggleDisplayButton.style.width=this.options.collapsedWidth+"px",this.toggleDisplayButton.style.height=this.options.collapsedHeight+"px"},e.prototype.createButton=function(t,i,o,e,n,s){var a=document.createElement("a");return a.className=o,a.innerHTML=t,a.href="#",a.title=i,a.addEventListener("click",this.preventDefault),a.addEventListener("mousedown",this.preventDefault),a.addEventListener("dblclick",this.preventDefault),this.onToggleButtonClick=this.toggle.bind(this),a.addEventListener("click",this.onToggleButtonClick),e.appendChild(a),a},e.prototype.toggleButtonInitialTitleText=function(){return this.options.minimized?this.options.showText:this.options.hideText},e.prototype.toggle=function(){this.minimized?this.restore():this.minimize()},e.prototype.minimize=function(){this.options.toggleDisplay?(this.container.style.width=this.options.collapsedWidth+"px",this.container.style.height=this.options.collapsedHeight+"px",this.toggleDisplayButton.className+=" minimized-"+this.options.togglePosition,this.toggleDisplayButton.title=this.options.showText):this.container.style.display="none",this.minimized=!0},e.prototype.restore=function(){this.options.toggleDisplay?(this.container.style.width=this.options.width+"px",this.container.style.height=this.options.height+"px",this.toggleDisplayButton.className=this.toggleDisplayButton.className.replace("minimized-"+this.options.togglePosition,""),this.toggleDisplayButton.title=this.options.hideText):this.container.style.display="block",this.minimized=!1},e.prototype.changeLayer=function(t){var i=this;this.miniMap.setStyle(t),this.miniMap.on("style.load",(function(){i.addRect(i.miniMap,i.options)}))},e.prototype.remove=function(){this.onRemove()},e.prototype.load=function(){var t=this.options,i=this.parentMap,o=this.miniMap;["dragPan","scrollZoom","boxZoom","dragRotate","keyboard","doubleClickZoom","touchZoomRotate"].forEach((function(i){!0!==t[i]&&o[i].disable()})),"function"==typeof t.zoomAdjust?this.options.zoomAdjust=t.zoomAdjust.bind(this):null===t.zoomAdjust&&(this.options.zoomAdjust=this.zoomAdjust.bind(this)),this.addRect(o,t),this.onMove=this.update.bind(this),this.onMouseMove=this.mouseMove.bind(this),this.onMouseDown=this.mouseDown.bind(this),this.onMouseUp=this.mouseUp.bind(this),i.on("move",this.onMove),o.on("mousemove",this.onMouseMove),o.on("mousedown",this.onMouseDown),o.on("mouseup",this.onMouseUp),o.on("touchmove",this.onMouseMove),o.on("touchstart",this.onMouseDown),o.on("touchend",this.onMouseUp),this.miniMapCanvas=o.getCanvasContainer(),this.miniMapCanvas.addEventListener("wheel",this.preventDefault),this.miniMapCanvas.addEventListener("mousewheel",this.preventDefault)},e.prototype.addRect=function(t,i){t.getLayer("trackingRectOutline")&&t.removeLayer("trackingRectOutline"),t.getLayer("trackingRectFill")&&t.removeLayer("trackingRectFill"),t.getSource("trackingRect")&&t.removeSource("trackingRect"),t.addSource("trackingRect",{type:"geojson",data:{type:"Feature",properties:{name:"trackingRect"},geometry:{type:"Polygon",coordinates:this.trackingRectCoordinates}}}),t.addLayer({id:"trackingRectOutline",type:"line",source:"trackingRect",layout:{},paint:{"line-color":i.lineColor,"line-width":i.lineWidth,"line-opacity":i.lineOpacity}}),t.addLayer({id:"trackingRectFill",type:"fill",source:"trackingRect",layout:{},paint:{"fill-color":i.fillColor,"fill-opacity":i.fillOpacity}}),this.trackingRect=this.miniMap.getSource("trackingRect"),this.update()},e.prototype.mouseDown=function(t){this.isCursorOverFeature&&(this.isDragging=!0,this.previousPoint=this.currentPoint,this.currentPoint=[t.lngLat.lng,t.lngLat.lat])},e.prototype.mouseMove=function(t){this.ticking=!1;var i=this.miniMap.queryRenderedFeatures(t.point,{layers:["trackingRectFill"]});if(this.isCursorOverFeature&&i.length>0||(this.isCursorOverFeature=i.length>0,this.miniMapCanvas.style.cursor=this.isCursorOverFeature?"move":""),this.isDragging){this.previousPoint=this.currentPoint,this.currentPoint=[t.lngLat.lng,t.lngLat.lat];var o=[this.previousPoint[0]-this.currentPoint[0],this.previousPoint[1]-this.currentPoint[1]],e=this.moveTrackingRect(o);this.parentMap.fitBounds(e,{duration:80})}},e.prototype.mouseUp=function(){this.isDragging=!1,this.ticking=!1},e.prototype.moveTrackingRect=function(t){var i=this.trackingRect,o=i._data,e=o.properties.bounds;return e._ne.lat-=t[1],e._ne.lng-=t[0],e._sw.lat-=t[1],e._sw.lng-=t[0],this.convertBoundsToPoints(e),i.setData(o),e},e.prototype.setTrackingRectBounds=function(t){var i=this.trackingRect,o=i._data;o.properties.bounds=t,this.convertBoundsToPoints(t),i.setData(o)},e.prototype.convertBoundsToPoints=function(t){var i=t._ne,o=t._sw,e=this.trackingRectCoordinates;e[0][0][0]=i.lng,e[0][0][1]=i.lat,e[0][1][0]=o.lng,e[0][1][1]=i.lat,e[0][2][0]=o.lng,e[0][2][1]=o.lat,e[0][3][0]=i.lng,e[0][3][1]=o.lat,e[0][4][0]=i.lng,e[0][4][1]=i.lat},e.prototype.update=function(){if(!this.isDragging){var t=this.parentMap.getBounds();this.setTrackingRectBounds(t),"function"==typeof this.options.zoomAdjust&&this.options.zoomAdjust()}},e.prototype.zoomAdjust=function(){var t=this.miniMap,i=this.parentMap,o=t.getZoom(),e=i.getZoom(),n=this.options.zoomLevels,s=!1;n.forEach((function(n){!s&&e>=n[0]&&(o>=n[1]&&t.setZoom(n[2]),t.setCenter(i.getCenter()),s=!0)})),s||o===this.options.zoom||("object"==typeof this.options.bounds&&t.fitBounds(this.options.bounds,{duration:50}),t.setZoom(this.options.zoom))},e.prototype.createContainer=function(t){var i=this.options,o=document.createElement("div");return o.className="mapbox-ctrl-minimap mapboxgl-ctrl",o.setAttribute("style","width: "+i.width+"px; height: "+i.height+"px;"),o.addEventListener("contextmenu",this.preventDefault),t.getContainer().appendChild(o),""!==i.id&&(o.id=i.id),o},e.prototype.preventDefault=function(t){t.preventDefault()},e}(i.NavigationControl);i.Minimap=o;
