/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(i,e)};var i=window.mapboxgl?window.mapboxgl:void 0,e=function(e){function o(t){var i=e.call(this)||this;return i.config=t,i.parentMap=null,i.miniMap=null,i.isDragging=!1,i.isCursorOverFeature=!1,i.previousPoint=[0,0],i.currentPoint=[0,0],i.trackingRectCoordinates=[[[],[],[],[],[]]],i.minimized=!1,i.options={id:"mapbox-minimap",width:320,height:180,style:"mapbox://styles/mapbox/streets-v8",center:[0,0],zoomLevelFixed:!1,zoomLevelOffset:-4,lineColor:"#08f",lineWidth:1,lineOpacity:1,fillColor:"#f80",fillOpacity:.25,dragPan:!1,scrollZoom:!1,boxZoom:!1,dragRotate:!1,keyboard:!1,doubleClickZoom:!1,touchZoomRotate:!1,minimized:!1,toggleDisplay:!0,collapsedWidth:20,collapsedHeight:20,togglePosition:"bottomleft",showText:"Show Minimap",hideText:"Hide Minimap"},t&&Object.assign(i.options,t),i}return function(i,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}(o,e),o.prototype.onAdd=function(t){this.parentMap=t;var e=this.options,o=this.createContainer(t);this.container=o;var n=this.miniMap=new i.Map({attributionControl:!1,container:o,style:e.style,center:e.center});return this.adjustZoom(),e.maxBounds&&n.setMaxBounds(e.maxBounds),this.onLoad=this.load.bind(this),n.on("load",this.onLoad),this.options.toggleDisplay&&this.addToggleButton(),this.container},o.prototype.onRemove=function(){this.parentMap.off("move",this.onMainMapMove),this.parentMap.off("move",this.onMainMapMoveEnd),this.miniMap.off("load",this.onLoad),this.miniMap.off("mousemove",this.onMouseMove),this.miniMap.off("mousedown",this.onMouseDown),this.miniMap.off("mouseup",this.onMouseUp),this.miniMap.off("touchmove",this.onMouseMove),this.miniMap.off("touchstart",this.onMouseDown),this.miniMap.off("touchend",this.onMouseUp),this.miniMapCanvas.removeEventListener("wheel",this.preventDefault),this.miniMapCanvas.removeEventListener("mousewheel",this.preventDefault),this.toggleDisplayButton.removeEventListener("click",this.preventDefault),this.toggleDisplayButton.removeEventListener("mousedown",this.preventDefault),this.toggleDisplayButton.removeEventListener("dblclick",this.preventDefault),this.toggleDisplayButton.removeEventListener("click",this.onToggleButtonClick),this.container.removeEventListener("contextmenu",this.preventDefault),this.container.removeChild(this.toggleDisplayButton),this.container.parentNode.removeChild(this.container),this.miniMap=null},o.prototype.addToggleButton=function(){this.toggleDisplayButton=this.options.toggleDisplay?this.createButton("",this.toggleButtonInitialTitleText(),"minimap mapbox-ctrl-minimap-toggle-display mapbox-ctrl-minimap-toggle-display-"+this.options.togglePosition,this.container,this.toggle,this):void 0,this.toggleDisplayButton.style.width=this.options.collapsedWidth+"px",this.toggleDisplayButton.style.height=this.options.collapsedHeight+"px"},o.prototype.createButton=function(t,i,e,o,n,s){var a=document.createElement("a");return a.className=e,a.innerHTML=t,a.href="#",a.title=i,a.addEventListener("click",this.preventDefault),a.addEventListener("mousedown",this.preventDefault),a.addEventListener("dblclick",this.preventDefault),this.onToggleButtonClick=this.toggle.bind(this),a.addEventListener("click",this.onToggleButtonClick),o.appendChild(a),a},o.prototype.toggleButtonInitialTitleText=function(){return this.options.minimized?this.options.showText:this.options.hideText},o.prototype.toggle=function(){this.minimized?this.restore():this.minimize()},o.prototype.minimize=function(){this.options.toggleDisplay?(this.container.style.width=this.options.collapsedWidth+"px",this.container.style.height=this.options.collapsedHeight+"px",this.toggleDisplayButton.className+=" minimized-"+this.options.togglePosition,this.toggleDisplayButton.title=this.options.showText):this.container.style.display="none",this.minimized=!0},o.prototype.restore=function(){this.options.toggleDisplay?(this.container.style.width=this.options.width+"px",this.container.style.height=this.options.height+"px",this.toggleDisplayButton.className=this.toggleDisplayButton.className.replace("minimized-"+this.options.togglePosition,""),this.toggleDisplayButton.title=this.options.hideText):this.container.style.display="block",this.minimized=!1},o.prototype.changeLayer=function(t){var i=this;this.miniMap.setStyle(t),this.miniMap.on("style.load",(function(){i.addRect(i.miniMap,i.options)}))},o.prototype.remove=function(){this.onRemove()},o.prototype.load=function(){var t=this.options,i=this.parentMap,e=this.miniMap;["dragPan","scrollZoom","boxZoom","dragRotate","keyboard","doubleClickZoom","touchZoomRotate"].forEach((function(i){!0!==t[i]&&e[i].disable()})),this.addRect(e,t),this.onMainMapMove=this.update.bind(this),this.onMainMapMoveEnd=this.parentMapMoved.bind(this),this.onMouseMove=this.mouseMove.bind(this),this.onMouseDown=this.mouseDown.bind(this),this.onMouseUp=this.mouseUp.bind(this),i.on("move",this.onMainMapMove),i.on("moveend",this.onMainMapMoveEnd),e.on("mousemove",this.onMouseMove),e.on("mousedown",this.onMouseDown),e.on("mouseup",this.onMouseUp),e.on("touchmove",this.onMouseMove),e.on("touchstart",this.onMouseDown),e.on("touchend",this.onMouseUp),this.miniMapCanvas=e.getCanvasContainer(),this.miniMapCanvas.addEventListener("wheel",this.preventDefault),this.miniMapCanvas.addEventListener("mousewheel",this.preventDefault)},o.prototype.addRect=function(t,i){t.getLayer("trackingRectOutline")&&t.removeLayer("trackingRectOutline"),t.getLayer("trackingRectFill")&&t.removeLayer("trackingRectFill"),t.getSource("trackingRect")&&t.removeSource("trackingRect"),t.addSource("trackingRect",{type:"geojson",data:{type:"Feature",properties:{name:"trackingRect"},geometry:{type:"Polygon",coordinates:this.trackingRectCoordinates}}}),t.addLayer({id:"trackingRectOutline",type:"line",source:"trackingRect",layout:{},paint:{"line-color":i.lineColor,"line-width":i.lineWidth,"line-opacity":i.lineOpacity}}),t.addLayer({id:"trackingRectFill",type:"fill",source:"trackingRect",layout:{},paint:{"fill-color":i.fillColor,"fill-opacity":i.fillOpacity}}),this.trackingRect=this.miniMap.getSource("trackingRect"),this.update()},o.prototype.mouseDown=function(t){this.isCursorOverFeature&&(this.isDragging=!0,this.previousPoint=this.currentPoint,this.currentPoint=[t.lngLat.lng,t.lngLat.lat])},o.prototype.mouseMove=function(t){var i=this.miniMap.queryRenderedFeatures(t.point,{layers:["trackingRectFill"]});if(this.isCursorOverFeature&&i.length>0||(this.isCursorOverFeature=i.length>0,this.miniMapCanvas.style.cursor=this.isCursorOverFeature?"move":""),this.isDragging){this.previousPoint=this.currentPoint,this.currentPoint=[t.lngLat.lng,t.lngLat.lat];var e=[this.previousPoint[0]-this.currentPoint[0],this.previousPoint[1]-this.currentPoint[1]],o=this.moveTrackingRect(e);this.parentMap.fitBounds(o,{duration:80})}},o.prototype.mouseUp=function(){this.isDragging=!1},o.prototype.moveTrackingRect=function(t){var i=this.trackingRect,e=i._data,o=e.properties.bounds;return o._ne.lat-=t[1],o._ne.lng-=t[0],o._sw.lat-=t[1],o._sw.lng-=t[0],this.convertBoundsToPoints(o),i.setData(e),o},o.prototype.setTrackingRectBounds=function(){var t=this.parentMap.getBounds(),i=this.trackingRect,e=i._data;e.properties.bounds=t,this.convertBoundsToPoints(t),i.setData(e)},o.prototype.convertBoundsToPoints=function(t){var i=t._ne,e=t._sw,o=this.trackingRectCoordinates;o[0][0][0]=i.lng,o[0][0][1]=i.lat,o[0][1][0]=e.lng,o[0][1][1]=i.lat,o[0][2][0]=e.lng,o[0][2][1]=e.lat,o[0][3][0]=i.lng,o[0][3][1]=e.lat,o[0][4][0]=i.lng,o[0][4][1]=i.lat},o.prototype.update=function(){this.isDragging||(this.options.zoomLevelFixed||this.adjustZoom(),this.setTrackingRectBounds())},o.prototype.parentMapMoved=function(){this.miniMap.setCenter(this.parentMap.getCenter()),this.options.zoomLevelFixed||this.adjustZoom()},o.prototype.adjustZoom=function(){this.miniMap.setZoom(this.parentMap.getZoom()+this.options.zoomLevelOffset)},o.prototype.createContainer=function(t){var i=this.options,e=document.createElement("div");return e.className="mapbox-ctrl-minimap mapboxgl-ctrl",e.setAttribute("style","width: "+i.width+"px; height: "+i.height+"px;"),e.addEventListener("contextmenu",this.preventDefault),t.getContainer().appendChild(e),""!==i.id&&(e.id=i.id),e},o.prototype.preventDefault=function(t){t.preventDefault()},o}(i.NavigationControl);i.Minimap=e;
